<view class="chat-container">
  <!-- Ê∂àÊÅØÂàóË°® -->
  <scroll-view class="messages" scroll-y="true" scroll-into-view="{{scrollToView}}" scroll-with-animation="true">
    <view class="message {{item.role}} {{item.isAlert ? 'alert' : ''}}" wx:for="{{messages}}" wx:key="id" id="msg-{{index}}">
      <view class="message-avatar" wx:if="{{item.role === 'model'}}">
        <text class="avatar-icon">{{item.isAlert ? '‚ö†Ô∏è' : 'ü§ñ'}}</text>
      </view>
      
      <view class="message-content-wrapper">
        <view class="message-content">
          <!-- ÂõæÁâá -->
          <view class="message-images" wx:if="{{item.images && item.images.length > 0}}">
            <image 
              wx:for="{{item.images}}" 
              wx:key="*this" 
              wx:for-item="img"
              src="{{img}}" 
              mode="aspectFill"
              class="message-image"
            />
          </view>
          <!-- ÊñáÂ≠ó -->
          <text class="message-text" wx:if="{{item.content}}">{{item.content}}</text>
        </view>
        <text class="message-time">{{item.timestamp ? item.timestamp : ''}}</text>
      </view>
    </view>
    
    <!-- Âä†ËΩΩ‰∏≠ÊèêÁ§∫ -->
    <view class="typing" wx:if="{{isTyping}}">
      <view class="typing-avatar">
        <text class="avatar-icon">ü§ñ</text>
      </view>
      <view class="typing-dots">
        <view class="dot"></view>
        <view class="dot"></view>
        <view class="dot"></view>
      </view>
    </view>
  </scroll-view>

  <!-- ÂõæÁâáÈ¢ÑËßàÂå∫ -->
  <view class="pending-images" wx:if="{{pendingImages.length > 0}}">
    <view class="pending-image-item" wx:for="{{pendingImages}}" wx:key="index">
      <image src="{{item}}" mode="aspectFill" class="pending-image" />
      <view class="remove-image" bindtap="removePendingImage" data-index="{{index}}">
        <text>√ó</text>
      </view>
    </view>
  </view>

  <!-- ËæìÂÖ•Âå∫Âüü -->
  <view class="input-area">
    <view class="input-container">
      <view class="input-actions">
        <view class="action-btn" bindtap="chooseImage">
          <text class="icon">üì∑</text>
        </view>
      </view>
      
      <textarea 
        class="input" 
        value="{{input}}" 
        bindinput="onInput" 
        placeholder="ËæìÂÖ•Ê∂àÊÅØ..."
        confirm-type="send"
        bindconfirm="sendMessage"
        auto-height
        maxlength="500"
      />
      
      <view class="send-btn {{input.trim() || pendingImages.length > 0 ? 'active' : ''}}" bindtap="sendMessage">
        <text class="icon">‚û§</text>
      </view>
    </view>
  </view>
</view>
