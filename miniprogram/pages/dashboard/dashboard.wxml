<view class="dashboard-container">
  <!-- é¢„ç®—è¿›åº¦æ¡ -->
  <view class="budget-section">
    <view class="budget-header">
      <text class="budget-title">æœ¬æœˆé¢„ç®—</text>
      <view class="settings-btn" bindtap="showBudgetModal">
        <text class="settings-icon">âš™ï¸</text>
      </view>
    </view>
    
    <view class="budget-amount">
      <text class="spent">Â¥{{totalSpentMonth}}</text>
      <text class="total">/ {{budgetConfig.totalBudget}}</text>
    </view>
    
    <view class="budget-progress">
      <progress 
        percent="{{budgetProgress}}" 
        stroke-width="8" 
        activeColor="{{budgetProgress > 100 ? '#ef4444' : budgetProgress > 80 ? '#f97316' : '#667eea'}}" 
        backgroundColor="#e2e8f0" 
        active="true" 
        active-mode="forwards"
      />
    </view>
    
    <view class="budget-info">
      <text class="progress-text">å·²ä½¿ç”¨ {{budgetProgress.toFixed(0)}}%</text>
      <text class="remaining-text">{{budgetProgress > 100 ? 'å·²è¶…æ”¯' : `å‰©ä½™ Â¥${budgetConfig.totalBudget - totalSpentMonth}`}}</text>
    </view>
  </view>
  
  <!-- æ¶ˆè´¹åˆ†å¸ƒå›¾è¡¨ -->
  <view class="chart-section" wx:if="{{expenseByCategory.length > 0}}">
    <text class="chart-title">æ¶ˆè´¹åˆ†å¸ƒ</text>
    <view class="chart-container">
      <view class="chart-bar" wx:for="{{expenseByCategory}}" wx:key="name">
        <view class="chart-label">
          <text class="category-name">{{item.name}}</text>
          <text class="category-amount">Â¥{{item.value}}</text>
        </view>
        <view class="chart-bar-bg">
          <view 
            class="chart-bar-fill" 
            style="width: {{(item.value / maxExpenseValue) * 100}}%; background: {{colors[index % colors.length]}};"
          ></view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- Tab åˆ‡æ¢ -->
  <view class="tabs">
    <view 
      class="tab {{activeTab === 'all' ? 'active' : ''}}" 
      data-tab="all" 
      bindtap="switchTab"
    >
      å…¨éƒ¨
    </view>
    <view 
      class="tab {{activeTab === 'mood' ? 'active' : ''}}" 
      data-tab="mood" 
      bindtap="switchTab"
    >
      å¿ƒæƒ…
    </view>
    <view 
      class="tab {{activeTab === 'expense' ? 'active' : ''}}" 
      data-tab="expense" 
      bindtap="switchTab"
    >
      æ¶ˆè´¹
    </view>
    <view 
      class="tab {{activeTab === 'event' ? 'active' : ''}}" 
      data-tab="event" 
      bindtap="switchTab"
    >
      è®°äº‹
    </view>
  </view>
  
  <!-- åˆ†ç±»ç­›é€‰ -->
  <view class="category-filter" wx:if="{{allCategories.length > 0}}">
    <scroll-view class="category-scroll" scroll-x="true">
      <view 
        class="category-item {{filterCategory === 'all' ? 'active' : ''}}" 
        data-category="all" 
        bindtap="filterByCategory"
      >
        å…¨éƒ¨
      </view>
      <view 
        class="category-item {{filterCategory === category ? 'active' : ''}}" 
        wx:for="{{allCategories}}" 
        wx:key="*this"
        data-category="{{item}}" 
        bindtap="filterByCategory"
      >
        {{item}}
      </view>
    </scroll-view>
  </view>
  
  <!-- è®°å½•åˆ—è¡¨ -->
  <scroll-view class="records-list" scroll-y="true">
    <view wx:if="{{filteredRecords.length === 0}}" class="empty-state">
      <text class="empty-text">æš‚æ— è®°å½•</text>
    </view>
    
    <view wx:else>
      <view 
        class="record-item" 
        wx:for="{{filteredRecords}}" 
        wx:key="id"
      >
        <!-- æ—¥æœŸ -->
        <view class="record-date">
          <text class="month">{{getMonth(item.timestamp)}}æœˆ</text>
          <text class="day">{{getDay(item.timestamp)}}</text>
        </view>
        
        <!-- å†…å®¹ -->
        <view class="record-content">
          <view class="record-header">
            <view class="record-title-section">
              <!-- å¿ƒæƒ… -->
              <view wx:if="{{item.type === 'MOOD'}}" class="mood-header">
                <text class="emoji">{{item.emoji}}</text>
                <text class="title">{{item.mood}}</text>
              </view>
              
              <!-- æ¶ˆè´¹ -->
              <text wx:elif="{{item.type === 'EXPENSE'}}" class="title">{{item.item}}</text>
              
              <!-- äº‹ä»¶ -->
              <text wx:elif="{{item.type === 'EVENT'}}" class="title">{{item.title}}</text>
            </view>
            
            <!-- æ¶ˆè´¹é‡‘é¢ -->
            <text wx:if="{{item.type === 'EXPENSE'}}" class="amount">-Â¥{{item.amount}}</text>
          </view>
          
          <!-- æ—¶é—´ -->
          <text class="time">{{formatTime(item.timestamp)}}</text>
          
          <!-- æè¿° -->
          <text wx:if="{{item.type === 'MOOD'}}" class="description">{{item.description}}</text>
          <text wx:elif="{{item.type === 'EVENT'}}" class="description">{{item.details}}</text>
          
          <!-- å›¾ç‰‡ -->
          <view class="images" wx:if="{{item.images && item.images.length > 0}}">
            <image 
              wx:for="{{item.images}}" 
              wx:key="index"
              src="{{img}}" 
              class="record-image"
              mode="aspectFill"
            />
          </view>
          
          <!-- æ ‡ç­¾ -->
          <view class="tags">
            <text 
              wx:for="{{getTags(item)}}" 
              wx:key="index"
              class="tag {{getTagClass(item, tag)}}"
            >
              #{{tag}}
            </text>
            
            <text 
              wx:if="{{item.type === 'EXPENSE'}}" 
              class="tag expense-category"
            >
              {{item.category}}
            </text>
            
            <text 
              wx:elif="{{item.type === 'EVENT'}}" 
              class="tag event-category"
            >
              {{item.category}}
            </text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- æ¸…ç©ºæ•°æ®æŒ‰é’® -->
    <view class="clear-data-section">
      <button class="clear-btn" bindtap="clearData">
        <text class="clear-icon">ğŸ—‘ï¸</text>
        <text>æ¸…ç©ºæ‰€æœ‰æ•°æ®</text>
      </button>
    </view>
  </scroll-view>
  
  <!-- é¢„ç®—è®¾ç½®å¼¹çª— -->
  <view class="modal" wx:if="{{showBudgetModalFlag}}">
    <view class="modal-overlay" bindtap="hideBudgetModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">é¢„ç®—è®¾ç½® (æ¯æœˆ)</text>
        <view class="modal-close" bindtap="hideBudgetModal">
          <text class="close-icon">Ã—</text>
        </view>
      </view>
      
      <view class="modal-body">
        <view class="budget-input-group">
          <text class="input-label">æœˆæ€»é¢„ç®—</text>
          <view class="input-wrapper">
            <text class="currency">Â¥</text>
            <input 
              class="budget-input" 
              type="digit" 
              value="{{tempBudget.totalBudget}}" 
              bindinput="onBudgetInput"
              data-field="totalBudget"
            />
          </view>
        </view>
        
        <view class="category-budgets">
          <text class="section-title">åˆ†ç±»é¢„ç®—</text>
          <view class="category-input" wx:for="{{commonCategories}}" wx:key="*this">
            <text class="category-label">{{item}}</text>
            <view class="input-wrapper small">
              <text class="currency">Â¥</text>
              <input 
                class="category-input-field" 
                type="digit" 
                value="{{tempBudget.categoryBudgets[item] || ''}}" 
                bindinput="onCategoryBudgetInput"
                data-category="{{item}}"
              />
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="save-btn" bindtap="saveBudgetConfig">ä¿å­˜è®¾ç½®</button>
      </view>
    </view>
  </view>
</view>